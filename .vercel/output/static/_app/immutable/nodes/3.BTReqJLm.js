import{S as E,i as z,s as P,e as x,d as y,n as S,f as d,o as T,h as U,j as m,k as v,l as I,m as p,p as w,q as k,r as q,v as h,w as f,x as D,y as b}from"../chunks/vendor.DPX5suGc.js";import{t as A}from"../chunks/twitter.CCBczVg7.js";import{g as L,c as O,f as V,u as B,a as M,t as R}from"../chunks/twitter.D1mL71c9.js";function j(u){let t,a,n,s,e;return{c(){t=m("div"),a=m("div"),n=v(),s=m("p"),e=I(u[2]),this.h()},l(r){t=p(r,"DIV",{class:!0});var o=w(t);a=p(o,"DIV",{class:!0}),w(a).forEach(d),n=k(o),s=p(o,"P",{});var c=w(s);e=q(c,u[2]),c.forEach(d),o.forEach(d),this.h()},h(){h(a,"class","spinner svelte-1x64zeq"),h(t,"class","loading svelte-1x64zeq")},m(r,o){y(r,t,o),f(t,a),f(t,n),f(t,s),f(s,e)},p(r,o){o&4&&D(e,r[2])},d(r){r&&d(t)}}}function F(u){let t,a,n,s,e,r="Something went wrong during authentication.",o,c,g="Back to Login";return{c(){t=m("div"),a=m("p"),n=I(u[1]),s=v(),e=m("p"),e.textContent=r,o=v(),c=m("a"),c.textContent=g,this.h()},l(i){t=p(i,"DIV",{class:!0});var l=w(t);a=p(l,"P",{class:!0});var _=w(a);n=q(_,u[1]),_.forEach(d),s=k(l),e=p(l,"P",{class:!0,"data-svelte-h":!0}),b(e)!=="svelte-3pu83s"&&(e.textContent=r),o=k(l),c=p(l,"A",{href:!0,class:!0,"data-svelte-h":!0}),b(c)!=="svelte-12k22ri"&&(c.textContent=g),l.forEach(d),this.h()},h(){h(a,"class","error svelte-1x64zeq"),h(e,"class","error-details svelte-1x64zeq"),h(c,"href","/login"),h(c,"class","back-button svelte-1x64zeq"),h(t,"class","error-container svelte-1x64zeq")},m(i,l){y(i,t,l),f(t,a),f(a,n),f(t,s),f(t,e),f(t,o),f(t,c)},p(i,l){l&2&&D(n,i[1])},d(i){i&&d(t)}}}function N(u){let t;function a(e,r){if(e[1])return F;if(e[0])return j}let n=a(u),s=n&&n(u);return{c(){s&&s.c(),t=x()},l(e){s&&s.l(e),t=x()},m(e,r){s&&s.m(e,r),y(e,t,r)},p(e,[r]){n===(n=a(e))&&s?s.p(e,r):(s&&s.d(1),s=n&&n(e),s&&(s.c(),s.m(t.parentNode,t)))},i:S,o:S,d(e){e&&d(t),s&&s.d(e)}}}function G(u,t,a){let n=!0,s="",e="Setting up your account...";return T(async()=>{try{a(2,e="Checking session...");let r=await L();if(!r&&(a(2,e="Initializing session..."),r=await O(),!r))throw new Error("Failed to create session");const o=new URLSearchParams(window.location.search),c=o.get("code"),g=o.get("state");if(!c||!g)throw new Error("Missing required OAuth parameters");a(2,e="Verifying Twitter credentials...");const{user:i,accessToken:l,refreshToken:_}=await A.handleCallback(c,g);a(2,e="Checking existing account...");const C=await V(i.username??"");C?(a(2,e="Updating your account..."),await B(C.$id,{lastLogin:new Date().toISOString(),accessToken:l,refreshToken:_||void 0,name:i.name??""})):(a(2,e="Creating your account..."),await M({userId:i.id,twitterId:i.username??"",createdAt:new Date().toISOString(),lastLogin:new Date().toISOString(),accessToken:l,refreshToken:_||void 0,name:i.name??"",username:i.username??""})),R.set(i),a(2,e="Redirecting to dashboard..."),await U("/dashboard")}catch(r){a(1,s=r instanceof Error?r.message:"Authentication failed"),console.error("Callback error:",r)}finally{a(0,n=!1)}}),[n,s,e]}class Q extends E{constructor(t){super(),z(this,t,G,N,P,{})}}export{Q as component};
